

経路運賃営業キロ計算アプリ
JR運賃、営業キロ表示、経路編集ソフト Farert 15.06
                                                　　 2015-07-08
                                              Copyright(C) 2014-2015 Sutezo

ソフトウェアについて
http://farert.blogspot.jp/p/main.html

ダウンロード＆セットアップ
http://farert.blogspot.jp/p/download.html

詳細
http://farert.blogspot.jp/p/detail.html

問い合わせ
http://farert.blogspot.jp/p/query.html

サポートサイト
http://farert.blogspot.jp


Windows版
Vectorサイト：
http://www.vector.co.jp/soft/winnt/home/se506752.html

iOS版
Appleサイト：
https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=916517676&mt=8

----------------------------------------------------------------------

 Contents

0 同梱物

1 ソフトの概要

2 作者への連絡先(メールアドレス、掲示板 等)

3 取り扱い種別(フリーソフト、シェアウェア 等)

4 動作環境

5 インストール・アンインストール方法

6 ご注意点

7 アプリケーション詳細・その他

  履歴

----------------------------------------------------------------------



0 同梱物

farert.exe                    ソフトウェア本体
readme.txt                    このファイル




1 ソフトの概要



「経路運賃キロ計算アプリ」は、JRグループ路線の指定した経路の運賃額と営業キロを
表示するものです。 一般的なルート検索アプリとくらべ、複雑な経路を手動で平易に
指定することができます。 
時刻を指定した最適化経路検索や特急券、割引切符の情報は扱っておりません。
普通旅客運賃計算経路の連続した区間の片道1回乗車で片道および往復の乗車券の運賃を
旅客営業規則に則り計算します。また、JR旅客各社以外の路線には対応していません。
2014年4月からの消費税8%に対応しています(オプションで5%も可)。

本ソフトウェアの使い方は、
- 脳内旅行をしながら、予算を立てる
- 青春18きっぷや各種割引切符で旅行にいってどれだけ得をすることができたか
  または、普通に乗車券を購入したほうが良いかの判定
- 途中分割で運賃が安くなるか
- 目的地の前後の値段を知る
- 営業キロ、計算キロを調べる
- 乗車券の有効日数を調べる
などが考えられます。

機能概要
- 各種旅客営業規則
- JR旅客会社６社全駅全路線
- JR線が通過する会社線（青い森鉄道、IGRいわて銀河鉄道、北越急行、伊勢鉄道、
  智頭急行、京都丹後鉄道、土佐くろしお鉄道、IRいしかわ、えちごトキめき鉄道、
  あいの風とやま鉄道）
- IC運賃
- 株主優待割引
- 往復割引
- 結果・経路保存
- 最短経路

* 通常発券されないルートや廃線、休止区間も指定できる箇所がありますので
  ご注意ください。



2 作者への連絡先(メールアドレス、掲示板 等)

  http://farert.blogspot.jp
  または、
  sutezo666@gmail.com
  　　（どちらも変わりません）

  ※ 異なる運賃・キロ程が表示されるような場合、可能な限り早めに対応しますので、
  　 ご連絡ください。


3 取り扱い種別(フリーソフト、シェアウェア 等)

　フリーソフトウェアです。
  制限なくご利用可能です。

  著作権: Copyright(C) 2014 Sutezo



4 動作環境

  Windows XP, Vista, 7, 8, 10. 等の Windowsプラットフォームで動作可能です。
  .NETフレームワークは利用しておりません。

  Windows 7 32bit / 64bit
  Windows 8.1 32bit /64bit
  Windows 10 preview 
  での動作確認を行っています。
  その他のOS(XP、Vista）でも動作可能です。

  開発環境は、MacbookAir(2013-Dec) 上の VMware Fusion6上のWindows7 64ビット版
  の Visual Studio 2010(SP1) です。
　動作確認はWindows7の他に、Windows8.1Pro.(64ビット)で確認しております。
  
  使用ライブラリは以下のものを利用しております。ランタイムライブラリ
　として、「Microsoft Visual C++ 2010 SP1 再頒布可能パッケージ (x86)」
　が必要になります。

　- Microsoft Foundation Class Library（MFC）
　- SQLite3 Version 3.8.6
　- Twofish
    Copyright 1998, Hi/fn and Counterpane Systems.  All rights reserved.

  本ソフトウェアは、ネットワークアクセスはLAN、WAN問わず一切していません。
  二重起動、多重起動は可能です。問題ありません。
  
  

5 インストール・アンインストール方法



farert ファイル一本を任意のフォルダへ配置し、実行してください。

「経路運賃営業キロ計算アプリ」を実行するには、任意のフォルダを作成し
（しなくても可）、farert.exe を移動またはコピーして実行してください。

実行時エラーメッセージが表示され、実行できなかった場合以下のファイルを
マイクロソフトのサイトからダウンロードしてインストールしてからあらためて
実行してください（WindowsXP, Vista, 7, Windows8、Windows10、
エディションの種類、32ビット、64ビット問わず）

Microsoft Visual C++ 2010 SP1 再頒布可能パッケージ (x86)
http://www.microsoft.com/ja-jp/download/details.aspx?id=8328


Windows8以降のOSで、はじめて実行する際に「WindowsによってPCが保護されました」と
表示される場合があります。このとき「実行」をクリックして問題ありません。
（「実行」ボタンがない場合「詳細」ボタンをクリックしてから「実行」ボタン
　をクリックしてください）




実行し、経路を指定するとhistory.txtファイルを作成します.
history.txtはfarertと同一フォルダに作成されます。
その他、経路（route.txt)ファイル、結果(result.txt)ファイルも同様です。
任意のフォルダに作成したい場合、一般的な方法ですが、
ショーカットファイルを作成し、ショートカットファイルの「プロパティ」
−「ショートカット」タブの−「作業フォルダー（S)」を任意のフォルダを
指定してください。

- history.txt        「発駅」、「着駅」指定時に追記される
- route.txt　　　　　「経路 保持」ボタンをクリック時に追記される
- result.txt　　　　 「結果 保持」ボタンをクリック時に追記される

上記のファイルはテキストファイルです。
いつでも削除や書き換えをしても問題ありません。
また、肥大化しないように定期的に削除・移動・リネーム等するよう
推奨します(そこまでヘビーに使っていただける人も居ないでしょうが、
いらした場合)

アンインストールは、farert.exe と上記のファイルを削除してください。

アップデートは、単にfarert.exeの上書き更新で問題ありません。


6 ご注意点・免責



本ソフトウェアを使用しての損害はいかなる場面において作者は一切責任を負いません。
本ソフトウェアおよび作者はJRグループとはなんの関係もありません。
本ソフトウェアにて算出される経路・金額は実際に旅行される際に発券される金額とは
異なる場合がありえます。実際に旅行される場合はごのことを十分ご理解のうえ、
参考程度にご利用いただければと思います。
作者は、不具合の修正義務、バージョンアップの義務をおいません。
※可能な限り対応はしたいと考えております。



7 アプリケーション詳細・その他

データソース切り替え機能として、起動引数に" tax5"  " 2014"   " 2015" のいずれ
かの文字列を指定すると、それぞれ消費税5%、2014年度版、2015年度版の路線データが
選択され計算されます（制限について後述）。
起動引数の指定は、farert.exe のコンテキストメニューからショートカットを作成し、
ショートカットのコンテキストメニューの「プロパティ」から「リンク先」の欄の
最後の farert.exe に続き、" 2014"とキーボードより文字列を追加して「OK」をクリック
します（デフォルトのショートカット名は、「farert.exe - ショートカット」などとなって
おりますが任意の名前に書き換えてください（例：「運賃計算2014」など）。
※ ショートカットを複数作成し、複数同時起動しても利用できます。

旅客営業規則・旅客営業取扱基準規定(以降、その区別を明示せず）は
69条、70条、86条、87条、88条、89条、114条、157条2項、43条-2あたりを考慮しています。
（いるつもりでいます）
上記の条文については、JR各社のWebサイトを参照してください。

駅名について
茅ヶ崎や、櫛ヶ浜といった駅名は、茅ケ崎、櫛ケ浜となります。
すべの「ヶ」は、「ケ」となります。（「ノ」は「の」もありますし「ノ」もあります）

線名について
通称名称での表示とはなっておりません（中央東線・西線や埼京線を除く）。
例えば茶屋町-多度津間を「本四備讃線」と表示し、「瀬戸大橋線」とはしておりません。

UI動作について
UI操作での経路に指定時、分岐特例（規則）を考慮した指定をした際に自動補正します。
例えば、中央西線 恵那から東海道新幹線で新横浜へ行く場合、
恵那-中央西線-名古屋-東海道新幹線-新横浜と指定が可能ですが（実際に乗車する経路
そのものの指定）、恵那-中央西線-金山‐東海道線‐三河安城-東海道新幹線-新横浜
という経路に補正されます。
実際には名古屋で（改札口の外に）下車せずに新幹線に乗車はできますが、
本ソフトウェアは、運賃計算上の経路（乗車券の実際の券面表示）として表示されます。

　同様に直江津から信越線で長岡で乗り換え、上越新幹線で大宮方面へ向かった場合も
長岡で乗換ができますが、表示は運賃計算経路である宮内から上越線で浦佐乗換の
新幹線経由と表示されます。
このような自動補正と相まって、一方同一路線を続けて指定できないUIとなっている
ところから指定ができない駅がでてきます。この場合「−(マイナス）」ボタンを
クリックして戻ってから再指定することにより対応可能です。


新幹線経路
中央東線で上り、東京から東北新幹線で下る場合、例えば、
新宿-中央東線-東京-東北新幹線-大宮と指定した場合、画面経路表示は
新宿-中央東線-神田-東北線-上野-東北新幹線-大宮となりますが、
東京から東北新幹線に乗車は可能です。運賃計算経路は70条が適用されますので、
<中央西線>塩尻<中央東線>新宿,赤羽<東北新幹線となります。
（新宿-赤羽は最短経路で算出し、経路は表示しない）


大阪環状線周り方向指定について
大阪環状線を一回経路に追加したとき、暗黙的に最短経路で計算します。
１回経路を指定した段階でツールバーメニューから「大阪環状線遠回り」を選択してください。
大阪環状線が２回目指定の際は経路が重複しない方向で自動選択されます。
（従来の今宮-天王寺間を関西線経由と指定することも可能です）

大阪環状線経路で大回り指定は経路指定後、Windows版は「大阪環状線大回り」
クリック、iOS版は、アクションメニュー「大阪環状線大回り」をタップします。
もう一度おこなうと戻ります（近回りになります）。
2回目の大阪環状線通過時は経路が片道として有効な方向で近いほうの廻りに自動的に
選択されます（1回目に通っていない経路が選択されます）。
1回目の経路の廻り方向を変えたい場合、2回目の大阪環状線を通ってない状態にまで
戻してから「大阪環状線大回り」（「大阪環状線近回り」）を選択してください。
そのあと、経路を追加していってください。



既知の不具合・仕様

- 災害等によるJRグループでは現在発券（販売）できない不通区間も
  指定・計算可能としております。

- 優等列車が直通し、通過・乗り入れする会社線の通過連絡運輸に対応しております。
  しかしながら、JRグループでは通常2社を2路線以上（あおい森鉄道、IGRいわてを除く）
  の利用では発券（販売）しませんが、本アプリでは計算可能です。

- BRTは考慮されておりません

- IC運賃適用区間は最短経路となるべきですが、自動での最短経路を適用しません。
　ユーザ自身が指定した経路に基づいて計算結果を表示するだけです（特定運賃区間を除く）。
　正しい結果は「経路」リストが空の状態で「最短経路」ボタンをクリックしたものになります。

- 最短経路は距離のみを考慮しているため、函館-札幌間では一般的ではない小樽経由が算出
　されますし、名古屋-大阪間においても関西本線経由となります。
　門司-長崎、熊本間で新幹線を含めた経路が最安(*)かつ高速ですが、距離の短い筑豊線経由で
　算出されてしまったりします。
　(*JR西の運賃計算となるため)

- 最短経路はおまけ機能であまり時間をかけて作成していません。簡単定番なアルゴリズムで
　実装しただけです。ソースコードを公開していますので良い方法があれば、GitHubのissueか
  Pullリクください。

- 臨時駅には対応していません。JRではその先の駅までの区間で計算することになっております
　のでそのようにご対応ください。
　
- データソースは２本あり、切り替え可能となっておりますが、以下の制限があります

  2014年度版：路線データは2014/12/30現在のデータとなっております。
  消費税５％版：路線データは2014年度版と同一のため、以下の情報で計算されます。
              - 吾妻線の八ッ場ダム関連のキロ程変更されたデータで計算します。
              - 東京近郊区間の範囲は2014年10月に拡大された範囲となります
               （乗車券の有効期間が当日限りとなる範囲が拡大される）
            との違いがあります。あくまでも参考データとしてお使いただくかたちで
            ご了承ください。

  2015年度版: 2014.3.14から改定の路線データ、2015.5.29開業予定の路線データ

- その他詳細は  http://farert.blogspot.jp を参照ください。


ソースコードをGitHubにて公開中です。
GitHubのIssueでも要望・バグ報告等を受け付けております。
GitHubサイトより、farert で検索してください。
iOS版(iPhone, iPod, iPADでも実行可)を2014年9月にリリースしています。
併せてご利用頂ければ幸いです。




-----履歴
2014/4/29  Ver1.0
           Vectorにて、Firstリリース
2014/5/25  GitHubにて、ソース公開
2014/9/19  iOS版をAppleStoreで公開
2014/10/12 Ver1.1 Windows、iOS8版 同時リリース
           - DB:吾妻線の距離変更に伴う修正
           - iOS版名阪神特定運賃の不具合の修正
           - 自動経路の修正
           - DB:廃止駅、臨時駅の削除
           - いわゆる用土問題(旅客営業取扱基準規程第115条第2項)の適用実装
           - SQLite3 Version 3.7.5 -> Version 3.8.6
           - iOS版とソース統一化
           - いくつかの不具合の修正

2014/10/24 Ver1.2
           - DB:田子倉駅の削除
           - DB:吾妻線全線が東京近郊区間になっていなかったのを追加
           - DB:川口が都区内駅とされていたのを修正

2014/11/15 Ver1.2.2
           - DB:本州3社の地方交通線のキロ程129キロ〜146キロの運賃が5,620円
           （5,616円)としていた（正しくは2,590円(2,592円）)
           - DB:本州3社の地方交通線のキロ程292キロ〜310キロの運賃が正しくなか
             った（正しくは5,620円（5,616円））
           - 仙台近郊区間で新幹線不利用の場合、乗車券の有効期間が異なるため
             山形新幹線を追加した。
           - 東海道新幹線 米原―新大阪、山陽新幹線 相生―西明石間利用は大都市
             近郊区間の範囲とした
           - 電車特別運賃区間に新幹線利用が除外されたのを修正
           - 大阪環状線廻りの運賃計算の不具合を修正（旅客営業規則第69条の(7)）


※ DB: とあるのはデータベースの変更のみで、ソースコード（ロジックなど）の変更
　をしていないものを指します

2015/3/2 15.03
           - 旅客営業規則70条を適用した経路での同86条／同87条、
             旅客営業取扱基準規程114条の適用の判定とする距離が誤って判定していた。
           - 大阪環状線経路で大回り指定可能とした
           - 大阪環状線経路で2回通過できるようにした。
           - 一部の旅客営業規則86条・87条で適用しないケースがあったのを修正
           2015.3.14からの改訂に合わせた修正
           - 北陸新幹線開業に対応
           - 北陸線から移管された、えちごときめき鉄道（妙高はねうまライン、
             日本海ひすいライン）、あいの風とやま鉄道、IRいしかわ鉄道の３社４路線を追加
           - 石巻線 女川のキロ程変更
           - 仙石線のキロ程変更
           - 仙石東北ライン追加（2015.5.29 開業予定）
           - 山陽線 新白島追加
           - 旧路線、消費税５％時代の計算も可能にした（データソース切り替え機能）
2014/3/30 15.03.02
           - 只見線 柿ノ木駅削除
           - 花輪線 北森駅 キロ程変更
           - 奥羽線 天童南追加
           - 大舟渡線(BRT) 長部、高田病院、高田高校前、碁石海岸口 追加
           - 大舟渡線 小友（おとも）がこともになってたのを修正（2014年版も）
           - 石巻線 浦宿-女川の換算キロ修正
           - 日豊線 南小倉から大分方面各駅から、小倉、山陽新幹線、博多と指定すると、
             鹿児島線経由となってしまう問題を修正

2015/7/8 15.06
          - 旅客営業規則第69条(6)の経路と(6)を除く同(1)から(9)を通る際に誤った経路変更を
            してしまう不具合の修正
          - 旅客営業取扱基準規程第114条が新幹線利用では適用されなかった不具合の修正
          - 山陽新幹線 小倉 日田彦山線 城野 と指定すると経路が終了してしまう不具合を修正
          - 駅名読みの誤りを修正（申し訳ありませんでした、かなり多数ありました）
          - 旅客営業取扱基準規程第114条が適用された運賃を主表示に変更
          - 岩泉線、江差線（渡島鶴岡-江差）の廃止の反映

以降の改版履歴と最新情報は下記サイトを参照ください。
http://farert.blogspot.jp/
「ラベル」-「リリース」をクリックしてください。



